# УДАЛЕНИЕ КРАКОЗЯБР ИЗ ФАЙЛА

## Это инструкция, как подготовить справочник кракозябр,
и выборочно заменить кракозябры в текстовом файле на нормальные символы,
в случае, когда невозможно преобразовать файл в другую кодировку целиком,
например если в файле перемешаны 2 и более кодировок.

Но для начала нужно определить кодировку кракозябр, для этого
можно воспользоваться утилитой iconv под linux
(iconv -l покажет список поддерживаемых кодировок),
notepad++ под windows, либо каким-нибудь онлайн сервисом для определения кодировки.

Все скрипты запускаются под linux.



## Генерирем 2 текстовых файла: bad.txt и good.txt,
оба должны быть в кодировке utf-8.

В good.txt помещаем список читаемых символов (построчно - 1 символ на каждой строке).

Затем копируем их в bad.txt, меняем кодировку (в моем случае на cp-1252),
при этом символы должны превратиться в кракозябры, и пересохраняем в формате utf-8, так,
чтобы кракозябры не изменились.

Я использовал notepad++ под windows, т.к. iconv под линукс почему-то
не может преобразовать, например, символ "я" из CP1252 в UTF-8:
echo "я" | iconv -f CP1252 -t UTF-8
iconv: недопустимая входная последовательность в позиции 1



## Копируем в директорию с файлами скрипт generateSerializedMap.php и запускаем.

Должем появиться файл serializedMap.txt - это сериализованный php-массив,
в котором хранится соответствие кракозябр и читаемых символов.



## Копируем в директорию с файлами скрипт converter.php.

Копируем содержимое файла serializedMap.txt в переменную $map в файле converter.php.



## Копируем текстовый файл с кракозябрами (файл должен быть в кодировке utf8)
в директорию с файлом converter.php (в моем случае это дамп базы данных).

Запускаем converter.php:
./converter.php rsduadmin.sql

Конвертер должен сгенерировать файл rsduadmin.sql.converted,
в котором кракозябры заменены нормальными символами.

Подробнее про использование конвертера написано в комментариях в файле converter.php
